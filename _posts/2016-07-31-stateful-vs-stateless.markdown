---
title: Кирилл Мокевнин о stateful и stateless
layout: post
date: 2016-07-31
category: dev
tags: [stateful, stateless, docker, vagrant, ansible]
video_provider: youtube
video_id: WPCz_U7D8PI
---
<div class="video-container mb3"><iframe width="560" height="315" src="https://www.youtube.com/embed/WPCz_U7D8PI" frameborder="0" allowfullscreen></iframe></div>

### Основная часть
- 00:14:05. Главный тезис вебинара: как только вам приходится, что-то удалять или изменять, сложность процесса возрастает на порядки.

- 00:16:00. Всё что является изменяемым состоянием, то что с ним связано, должно быть изолировано. Это уменьшает влияние на другие части системы и позволяет
проще масшатбировать те части системы, которые не являются стейтфул.

- 00:24:10. Что является состоянием конкретного сервера?

- 00:26:25. Пример с обновлением софта на сервере.

- 00:32:35. Стейтфул — это сложно. Идеально, если вы делегируете стейтфул сервера другим компаниям, которые решат за вас эти проблемы. Например Амазон.

- 00:34:40. Пример неправильного подхода в решении проблемы изменяемости.

- 00:37:00. Вагрант не просто изолирует ваше окружение от хост машины, фишка Вагранта в том, что вы легко можете экспереминтировать с состоянием. В случае краха довольно просто вернуться к первоначальному стостоянию. Конечно, предполагается, что вы также пользуетесь системой конфигурции, например Энсиблом.

- 00:37:50. Главная фишка докера «имьютебл ифрастракче». Докер не заменяет систем конфигурации, но решает проблему обновления софта.

- 00:45:50. Обратная сторона докера, в том, что докер-имаджы могут собираться довольно долго. Это приводит к тому, что хотфикс невозможен. Тем не менее докер нужно использовать уже прямо сейчас. В этом нет ничего сложного.

- 00:50:25. Про деплой и выкатывание нового сервиса.

- 00:56:40. В деплое *самое главное быстрый и крайне простой откат.*

- 01:01:00. Откатывать базу данных нельзя никогда.

- 01:03:45. База, как минимум, должна уметь рабтать с текущей, предыдущей и новой версиями кода.

- 01:09:55. В большинстве типичных проектов можно обойтись без стейджинга.

- 01:11:20. Резюме по базам данных.

- 01:14:05. И всё-таки из базы можно удалять всё, что раньше трёх последних версий.

- 01:20:00. Что делать, если нужно часть инфраструктуры перенести на другой сервис?

- 01:23:00. Что делать, если структуру данных в очереди нужно изменить?

- 01:30:10. Микросервисы и состояние.

### Вопросы из чата
- 01:32:20. Почему Докер не может заменить Вагрант?

### Допольнительно
- [The Twelve-Factor App](http://12factor.net/)
- [Building Twelve Factor Apps on Heroku](https://blog.heroku.com/twelve-factor-apps)
- [Почему сложно программировать UI (Кирилл Мокевнин)](https://www.youtube.com/watch?v=DCeNCr2tKOI&t=0s)

### Бонус
01:19:35. *Это не значит что мы не косячим. Мы реально раздолбаи. Если вы видите какие-то косяки и баги на Хекслете, это значит, что мы просто ленивые.*